gulp-closure
============

closure compiler plugin for gulp.

getting started
---------------

Make sure that you have a copy of the [closure compiler jar](https://github.com/google/closure-compiler) file accessible to your project. By default the plugin will look for:

`PROJECT_HOME/closure/compiler.jar`

Install the plugin with

`npm install gulp-closure --save-dev`

example gulp setup
------------------
```javascript
var gulp      = require('gulp'),
    compiler  = require('gulp-closure');

gulp.task('compile' function() {

  gulp.src('src/**/*.js')
  .pipe(compiler())
  .pipe(gulp.dest('/output'));
});
```

You can pass a plethora of configuration options to the plugin via a configuration object passed at config time.

```javascript
var gulp      = require('gulp'),
    glob      = require('glob'),
    compiler  = require('gulp-closure')({
      plugin    : {
        compiler                 : 'closure/build/compiler.jar',
        maxBuffer                : 1024 * 1024 * 20
      },
      compiler  : {
        '--angular_pass'         : null,
        '--compilation_level'    : 'ADVANCED_OPTIMIZATIONS',
        '--externs'              : glob.sync('closure/externs/**/*.jsx')
      },
      java      : {
        '-XX:+TieredCompilation' : null
      }
    });

gulp.task('compile' function() {

  gulp.src('src/**/*.js')
  .pipe(compiler)
  .pipe(gulp.dest('/output'));
});
```

options
-------

The `options` object contains 3 sub-objects: `plugin`, `compiler` and `java`.

The `plugin` object change the behaviour of the plugin itself:
- `debug` if this is true temporary folders will not be deleted. This allows you to see the flagfile which is created for debugging purposes. Defaults to off.
- `compiler` this option is a string which is the relative path to the compiler jar.
- `flagfile` this option is the name of the flagfile that will be generated by the plugin. You shouldn't need to change this unless the default ('flagfile.tmp') clashes with any of the other temporary files that will be created during compilation.
- `output` this option sets the name of the output file that will be passed back to the gulp stream. Default is `output.min.js`
- `maxBuffer` this option sets the maxBuffer options for the process that node creates. Default is `1024 * 1024 * 20`

The `compiler` object is serialized into the flags to be passed to the compiler, By default we don't pass any options that aren't required to the compiler.
- The keys of the objecct will map directly to the flag name created.
- If you want to create a flag which has no value, simply set its value to `null`

_example_
```javascript
compiler : {
  '--angular_pass' : null,
  '--compilation_level' : 'ADVANCED_OPTIMIZATIONS'
}
```

Will become

`--angular_pass --compilation_level="ADVANCED_OPTIMIZATIONS"`

There are some options that are not supported currently by the plugin, these are:
- `--module`
- `--flag_file`
- `--js_output_file`

For more information see source code.

The `java` object is used to set options for the java instance used to run the compiler. This object is serialized in the same way that the compiler object is. 

_example_
```javascript
java : {
  '-XX:+TieredCompilation' : null
}
```

TODO
----
- Come up with some kind of solution for creating modules.
- Possibly use `--js_output_file` instead of `stdout` to save files, as this may cause issues.
- Possibly do something with the compiler warning/error output.